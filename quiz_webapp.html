<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√în Luy·ªán Tr·∫Øc Nghi·ªám</title>
    
    <meta name="theme-color" content="#2563EB"> 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Quiz App">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* T√πy ch·ªânh font cho to√†n b·ªô ·ª©ng d·ª•ng */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Custom scrollbar cho c√°c n·ªôi dung d√†i tr√™n thi·∫øt b·ªã di ƒë·ªông (ch·ªß y·∫øu cho Options Container) */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .custom-scroll {
             /* ·∫®n scrollbar tr√™n Firefox */
            scrollbar-width: thin; 
            scrollbar-color: #cbd5e1 transparent;
        }
        /* Hi·ªáu ·ª©ng ch·ªçn ƒë√°p √°n */
        .option-item {
            transition: all 0.2s;
        }
        .option-item:not(.answered):hover {
            background-color: #f0f4f7;
            cursor: pointer;
        }
        /* Icon placeholder cho PWA */
        .app-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            line-height: 1;
            width: 64px;
            height: 64px;
            border-radius: 16px;
            background-color: #2563EB;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div id="app" class="flex-grow flex flex-col items-center justify-start p-4 sm:p-6">
        </div>

    <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 items-center justify-center" 
         role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <div class="bg-white rounded-xl p-6 max-w-sm w-full shadow-2xl transition-transform transform scale-100 duration-300">
            <h3 id="modal-title" class="text-xl font-bold text-gray-800 mb-4">Th√¥ng b√°o</h3>
            <p id="modal-message" class="text-gray-700 mb-6 whitespace-pre-line"></p>
            <div class="flex justify-end space-x-3">
                <button id="modal-cancel-btn" class="hidden px-4 py-2 text-gray-600 bg-gray-200 rounded-lg font-semibold hover:bg-gray-300 transition duration-150" aria-label="H·ªßy b·ªè">H·ªßy</button>
                <button id="modal-confirm-btn" class="px-4 py-2 text-white bg-blue-600 rounded-lg font-semibold hover:bg-blue-700 transition duration-150" aria-label="ƒê·ªìng √Ω">ƒê·ªìng √Ω</button>
            </div>
        </div>
    </div>

    <script>
        // --- C·∫§U H√åNH ·ª®NG D·ª§NG (ƒê√É C·∫¨P NH·∫¨T THEO Y√äU C·∫¶U) ---
        const NUM_QUESTIONS = 70;
        const TIME_LIMIT_MINUTES = 60;

        // üí° C·∫§U H√åNH X·∫æP LO·∫†I: Ng∆∞·ª°ng % c√¢u ƒë√∫ng ƒë·ªÉ ƒë·∫°t m·ªói m·ª©c ƒë·ªô
        // Key l√† t√™n x·∫øp lo·∫°i, Value l√† ng∆∞·ª°ng % T·ªêI THI·ªÇU c·∫ßn ƒë·∫°t
        const RATING_THRESHOLDS = {
            'Xu·∫•t s·∫Øc': 90, // >= 90% (t∆∞∆°ng ƒë∆∞∆°ng 63/70 c√¢u)
            'Gi·ªèi': 80,     // >= 80% (t∆∞∆°ng ƒë∆∞∆°ng 56/70 c√¢u)
            'Kh√°': 70,      // >= 70% (t∆∞∆°ng ƒë∆∞∆°ng 49/70 c√¢u)
            'Trung b√¨nh': 50, // >= 50% (t∆∞∆°ng ƒë∆∞∆°ng 35/70 c√¢u - m·ª©c ƒê·∫°t t·ªëi thi·ªÉu)
        };
        const FAIL_RATING = 'Kh√¥ng ƒê·∫°t'; // D∆∞·ªõi m·ª©c th·∫•p nh·∫•t (d∆∞·ªõi 50%)
        
        const COLOR_CORRECT = "text-green-700";
        const COLOR_INCORRECT = "text-red-700";
        const COLOR_ACCENT = "text-blue-600";
        // ---------------------------------------------

        // --- BI·∫æN TO√ÄN C·ª§C ---
        let username = "";
        let questions = [];
        let currentQuestion = 0;
        let userAnswers = [];
        let isAnswered = []; 
        let timeLimit = TIME_LIMIT_MINUTES * 60;
        let timeLeft = timeLimit;
        let timerInterval;
        let allQuestions = [];
        
        // H√†m m·ªõi: X√°c ƒë·ªãnh x·∫øp lo·∫°i d·ª±a tr√™n s·ªë c√¢u ƒë√∫ng
        function getRating(correctCount, totalQuestions) {
            if (totalQuestions === 0) return FAIL_RATING;

            // T√≠nh t·ª∑ l·ªá % c√¢u ƒë√∫ng
            const correctPercent = (correctCount / totalQuestions) * 100;
            
            // S·∫Øp x·∫øp c√°c ng∆∞·ª°ng t·ª´ cao xu·ªëng th·∫•p ƒë·ªÉ ki·ªÉm tra
            // ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o 63/70 (90%) s·∫Ω ƒë∆∞·ª£c x·∫øp l√† 'Xu·∫•t s·∫Øc' ch·ª© kh√¥ng ph·∫£i 'Gi·ªèi'
            const sortedRatings = Object.entries(RATING_THRESHOLDS)
                .sort(([, a], [, b]) => b - a); 
            
            for (const [rating, threshold] of sortedRatings) {
                if (correctPercent >= threshold) {
                    return rating;
                }
            }
            
            return FAIL_RATING;
        }

        // H√†m hi·ªÉn th·ªã Modal (thay th·∫ø messagebox)
        function showModal(title, message, isConfirm = false, onConfirm = null) {
            const backdrop = document.getElementById('modal-backdrop');
            const titleEl = document.getElementById('modal-title');
            const messageEl = document.getElementById('modal-message');
            const confirmBtn = document.getElementById('modal-confirm-btn');
            const cancelBtn = document.getElementById('modal-cancel-btn');

            titleEl.textContent = title;
            messageEl.textContent = message;

            // ƒê·∫£m b·∫£o Modal ƒë∆∞·ª£c focus ƒë√∫ng
            backdrop.focus();

            backdrop.classList.remove('hidden');
            backdrop.classList.add('flex');

            confirmBtn.onclick = () => {
                backdrop.classList.add('hidden');
                backdrop.classList.remove('flex');
                if (isConfirm && onConfirm) {
                    // C·∫ßn x√≥a timer sau khi n·ªôp b√†i
                    if (timerInterval) clearInterval(timerInterval);
                    onConfirm();
                }
            };

            if (isConfirm) {
                cancelBtn.classList.remove('hidden');
                cancelBtn.onclick = () => {
                    backdrop.classList.add('hidden');
                    backdrop.classList.remove('flex');
                };
                confirmBtn.textContent = "N·ªôp b√†i";
                confirmBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                confirmBtn.classList.add('bg-red-600', 'hover:bg-red-700');
            } else {
                cancelBtn.classList.add('hidden');
                confirmBtn.textContent = "ƒê√≥ng";
                confirmBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
                confirmBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            }
        }

        // ƒê·ªçc d·ªØ li·ªáu t·ª´ file JSON (m√¥ ph·ªèng load_questions)
        async function loadQuestions() {
            if (allQuestions.length > 0) return allQuestions;
            try {
                // S·ª¨ D·ª§NG FILE T·ª™ KHO L∆ØU TR·ªÆ C·ª¶A NG∆Ø·ªúI D√ôNG
                const response = await fetch('de_full.json'); 
                if (!response.ok) {
                    throw new Error(`T·∫£i l·ªói. Status: ${response.status}`);
                }
                allQuestions = await response.json();
                return allQuestions;
            } catch (error) {
                showModal("L·ªói h·ªá th·ªëng", `L·ªói khi t·∫£i c√¢u h·ªèi: Vui l√≤ng ki·ªÉm tra file de_full.json c·ªßa b·∫°n:\n${error.message}`);
                return [];
            }
        }

        // Ghi k·∫øt qu·∫£ (trong Web App, ch√∫ng ta ch·ªâ hi·ªÉn th·ªã, kh√¥ng l∆∞u v√†o CSV)
        function saveResult(name, correct, total, score, status) {
            console.log(`K·∫øt qu·∫£ c·ªßa ${name}: ƒê√∫ng ${correct}/${total}, ƒêi·ªÉm: ${score.toFixed(2)}, X·∫øp lo·∫°i: ${status}`);
        }

        // --- QU·∫¢N L√ù GIAO DI·ªÜN ---

        function clearWindow() {
            document.getElementById('app').innerHTML = '';
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeText = `‚è∞ ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            const timerEl = document.getElementById('timer-label');
            if (timerEl) {
                timerEl.textContent = timeText;
                if (timeLeft <= 60) {
                    timerEl.classList.remove('text-red-600');
                    timerEl.classList.add('text-red-800', 'font-extrabold', 'animate-pulse');
                } else {
                    timerEl.classList.remove('text-red-800', 'font-extrabold', 'animate-pulse');
                    timerEl.classList.add('text-red-600');
                }
            }
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateTimerDisplay();
                } else {
                    clearInterval(timerInterval);
                    showModal("H·∫øt gi·ªù", "B·∫°n ƒë√£ h·∫øt th·ªùi gian l√†m b√†i. B√†i l√†m s·∫Ω ƒë∆∞·ª£c t·ª± ƒë·ªông n·ªôp.", false); // Kh√¥ng c·∫ßn callback, v√¨ submitQuiz() s·∫Ω ƒë∆∞·ª£c g·ªçi ngay
                    submitQuiz();
                }
            }, 1000);
        }

        // --- X·ª¨ L√ù L∆ØU ƒê√ÅP √ÅN V√Ä PH·∫¢N H·ªíI ---
        function handleAnswerSelection(selectedOptionIndex) {
            const qIndex = currentQuestion;
            
            // Trong ch·∫ø ƒë·ªô Luy·ªán t·∫≠p (ch·∫ø ƒë·ªô m·∫∑c ƒë·ªãnh), ph·∫£n h·ªìi ngay.
            if (isAnswered[qIndex]) {
                return; 
            }

            userAnswers[qIndex] = selectedOptionIndex;
            isAnswered[qIndex] = true;
            
            showQuestion(); // V·∫º L·∫†I ƒë·ªÉ √°p d·ª•ng m√†u s·∫Øc ph·∫£n h·ªìi
        }

        // --- C√ÅC M√ÄN H√åNH CH√çNH ---

        function showHome() {
            clearWindow();
            if (timerInterval) clearInterval(timerInterval);

            const content = `
                <div class="max-w-xl w-full text-center bg-white p-6 sm:p-8 rounded-xl shadow-2xl mt-8 flex flex-col items-center">
                    <span class="app-icon mb-6">üìù</span>
                    <h1 class="text-3xl sm:text-4xl font-extrabold ${COLOR_ACCENT} mb-2">√îN LUY·ªÜN TR·∫ÆC NGHI·ªÜM</h1>
                    <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-8 italic">Ch·∫ø ƒë·ªô Luy·ªán t·∫≠p (Ph·∫£n h·ªìi ngay)</h2>
                    
                    <label for="name-entry" class="block text-left w-full text-gray-700 font-semibold mb-2 text-lg">Nh·∫≠p t√™n c·ªßa b·∫°n:</label>
                    <input type="text" id="name-entry" placeholder="V√≠ d·ª•: Nguy·ªÖn VƒÉn A"
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg mb-8" />
                    
                    <button id="start-quiz-btn"
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-extrabold py-4 px-6 rounded-xl text-xl transition duration-300 shadow-lg transform hover:scale-[1.01]">
                        B·∫Øt ƒë·∫ßu l√†m b√†i (${NUM_QUESTIONS} c√¢u, ${TIME_LIMIT_MINUTES} ph√∫t)
                    </button>
                    <p class="text-sm text-gray-500 mt-4">D·ªØ li·ªáu ƒë∆∞·ª£c l·∫•y t·ª´ file de_full.json</p>
                </div>
            `;
            document.getElementById('app').innerHTML = content;
            
            document.getElementById('start-quiz-btn').addEventListener('click', startQuiz);
        }

        async function startQuiz() {
            const nameEntry = document.getElementById('name-entry');
            const name = nameEntry.value.trim();

            if (!name) {
                showModal("Thi·∫øu t√™n", "Vui l√≤ng nh·∫≠p t√™n c·ªßa b·∫°n.");
                return;
            }

            username = name;
            
            allQuestions = await loadQuestions();

            if (allQuestions.length === 0) return;
              
            if (allQuestions.length < NUM_QUESTIONS) {
                showModal("L·ªói", `Ng√¢n h√†ng c√¢u h·ªèi ph·∫£i c√≥ √≠t nh·∫•t ${NUM_QUESTIONS} c√¢u. Hi·ªán c√≥ ${allQuestions.length} c√¢u. Vui l√≤ng ki·ªÉm tra l·∫°i file JSON.`);
                return;
            }

            // L·∫•y ng·∫´u nhi√™n c√¢u h·ªèi (Fisher-Yates shuffle)
            const shuffledQuestions = [...allQuestions];
            for (let i = shuffledQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledQuestions[i], shuffledQuestions[j]] = [shuffledQuestions[j], shuffledQuestions[i]];
            }

            questions = shuffledQuestions.slice(0, NUM_QUESTIONS);

            // Kh·ªüi t·∫°o tr·∫°ng th√°i
            userAnswers = Array(questions.length).fill(-1); 
            isAnswered = Array(questions.length).fill(false); 
            currentQuestion = 0;
            timeLeft = timeLimit;

            startTimer();
            showQuestion();
        }


        function showQuestion() {
            clearWindow();
            const question = questions[currentQuestion];
            const selectedAnswer = userAnswers[currentQuestion];
            const correctIndex = question.correct_answer_index;
            const isCurrentQAnswered = isAnswered[currentQuestion];
            const alphabet = 'ABCD';

            const header = `
                <div class="fixed top-0 left-0 w-full bg-white shadow-md p-3 sm:p-4 flex justify-between items-center z-10">
                    <div class="text-xs sm:text-base font-medium text-gray-600">Th√≠ sinh: <span class="font-bold text-gray-800">${username}</span></div>
                    <div id="timer-label" class="text-sm sm:text-lg font-bold text-red-600 transition-colors duration-500"></div>
                </div>
                <div class="h-12 sm:h-16 w-full"></div> `;

            const questionContent = `
                <div class="w-full max-w-2xl bg-white p-5 sm:p-6 rounded-xl shadow-lg flex-grow flex flex-col mb-4">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl sm:text-2xl font-extrabold ${COLOR_ACCENT}">
                            C√¢u ${currentQuestion + 1}/${questions.length}
                        </h2>
                        <span class="text-sm font-medium text-gray-500">ID: ${question.id}</span>
                    </div>
                    
                    <p class="text-gray-800 text-lg sm:text-xl font-semibold mb-6 leading-relaxed">
                        ${question.question}
                    </p>

                    <div id="options-container" class="space-y-4 flex-grow custom-scroll overflow-y-auto pb-4">
                        ${question.options.map((option, i) => {
                            let optionClasses = 'option-item p-4 rounded-lg border shadow-sm transition duration-150';
                            let icon = '<span class="text-gray-400 font-bold mr-3 text-lg">‚óã</span>'; // M·∫∑c ƒë·ªãnh ch∆∞a ch·ªçn

                            if (isCurrentQAnswered) {
                                // N·∫øu ƒë√£ tr·∫£ l·ªùi v√† ƒê√öNG
                                if (i === correctIndex) {
                                    optionClasses += ` bg-green-100 border-green-400 ${COLOR_CORRECT} answered font-bold`;
                                    icon = '<span class="text-green-600 font-extrabold mr-3 text-lg">‚úÖ</span>';
                                } 
                                // N·∫øu ƒë√£ tr·∫£ l·ªùi v√† SAI (v√† ƒë√≥ l√† ƒë√°p √°n ng∆∞·ªùi d√πng ch·ªçn)
                                else if (i === selectedAnswer && i !== correctIndex) {
                                    optionClasses += ` bg-red-100 border-red-400 ${COLOR_INCORRECT} answered font-bold`;
                                    icon = '<span class="text-red-600 font-extrabold mr-3 text-lg">‚ùå</span>';
                                } 
                                // C√°c ƒë√°p √°n c√≤n l·∫°i (ƒë√£ tr·∫£ l·ªùi)
                                else {
                                    optionClasses += ` bg-gray-50 text-gray-600 answered`;
                                }
                            } else {
                                // Ch∆∞a tr·∫£ l·ªùi (Ch·ªâ t√¥ m√†u l·ª±a ch·ªçn hi·ªán t·∫°i)
                                optionClasses += ' hover:bg-blue-50';
                                if (i === selectedAnswer) {
                                    optionClasses += ' bg-blue-100 border-blue-400 font-bold';
                                    icon = '<span class="text-blue-600 font-extrabold mr-3 text-lg">‚óè</span>';
                                } else {
                                    icon = '<span class="text-gray-500 font-bold mr-3 text-lg">‚óã</span>'; 
                                }
                            }

                            return `
                                <div id="option-${i}" data-index="${i}" 
                                      class="${optionClasses} flex items-start text-base sm:text-lg"
                                      onclick="handleAnswerSelection(${i})">
                                    ${icon}
                                    <span class="font-bold mr-2 text-gray-700">${alphabet[i]}.</span>
                                    <span class="flex-grow text-gray-800">${option}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;

            const footer = `
                <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-3 sm:p-4 flex justify-center items-center space-x-3 sm:space-x-4 z-10 shadow-lg">
                    <button id="prev-btn" 
                                class="flex-1 max-w-[150px] bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-150 text-sm sm:text-lg">
                        ‚Üê Quay l·∫°i
                    </button>
                    
                    ${currentQuestion < questions.length - 1 ? 
                        `<button id="next-btn" 
                                     class="flex-1 max-w-[150px] bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 text-sm sm:text-lg">
                            Ti·∫øp theo ‚Üí
                        </button>`
                        :
                        `<button id="submit-btn" 
                                     class="flex-1 max-w-[150px] bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 text-sm sm:text-lg">
                            N·ªôp b√†i
                        </button>`
                    }
                </div>
            `;
            
            document.getElementById('app').innerHTML = header + questionContent + footer;

            // C·∫≠p nh·∫≠t l·∫°i Timer
            updateTimerDisplay();

            // C√†i ƒë·∫∑t s·ª± ki·ªán
            const prevBtn = document.getElementById('prev-btn');
            if (currentQuestion === 0) {
                prevBtn.disabled = true;
                prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                prevBtn.addEventListener('click', prevQuestion);
            }

            if (currentQuestion < questions.length - 1) {
                document.getElementById('next-btn').addEventListener('click', nextQuestion);
            } else {
                document.getElementById('submit-btn').addEventListener('click', confirmSubmit);
            }
        }

        function nextQuestion() {
            currentQuestion = Math.min(currentQuestion + 1, questions.length - 1);
            showQuestion();
        }

        function prevQuestion() {
            currentQuestion = Math.max(currentQuestion - 1, 0);
            showQuestion();
        }

        function confirmSubmit() {
            const unansweredCount = userAnswers.filter(a => a === -1).length;
            
            let confirmMessage = `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i kh√¥ng?`;
            if (unansweredCount > 0) {
                 confirmMessage += `\n(B·∫°n c√≤n ${unansweredCount} c√¢u ch∆∞a ch·ªçn ƒë√°p √°n.)`;
            }
            
            showModal("X√°c nh·∫≠n n·ªôp b√†i", confirmMessage, true, submitQuiz);
        }

        function submitQuiz() {
            if (timerInterval) clearInterval(timerInterval);
            
            let correct = 0;
            const total = questions.length;

            for (let i = 0; i < total; i++) {
                const userChoice = userAnswers[i];
                const correctIndex = questions[i].correct_answer_index; 

                if (userChoice !== -1 && userChoice === correctIndex) {
                    correct++;
                }
            }

            // V·∫´n t√≠nh ƒëi·ªÉm ƒë·ªÉ hi·ªÉn th·ªã tr√™n thang 10
            const score = correct / total * 10; 
            
            // üí° LOGIC X·∫æP LO·∫†I M·ªöI: X·∫øp lo·∫°i chi ti·∫øt theo % c√¢u ƒë√∫ng
            const status = getRating(correct, total); 

            saveResult(username, correct, total, score, status); 
            showResult(correct, total, score, status);
        }

        function showResult(correct, total, score, status) {
            clearWindow();
            
            // Ki·ªÉm tra xem tr·∫°ng th√°i c√≥ ph·∫£i l√† "Kh√¥ng ƒê·∫°t" hay kh√¥ng
            const isPassing = status !== FAIL_RATING; 
            
            const statusColor = isPassing ? COLOR_CORRECT : COLOR_INCORRECT;
            const statusBg = isPassing ? "bg-green-50" : "bg-red-50";

            // Thay ƒë·ªïi m√†u ƒëi·ªÉm d·ª±a tr√™n k·∫øt qu·∫£
            const scoreColor = isPassing ? COLOR_CORRECT : COLOR_INCORRECT;
            
            // L·∫•y ng∆∞·ª°ng % c·ªßa m·ª©c Trung b√¨nh (m·ª©c ƒê·∫°t t·ªëi thi·ªÉu) ƒë·ªÉ hi·ªÉn th·ªã th√¥ng tin
            const passThresholdPercent = RATING_THRESHOLDS['Trung b√¨nh'];

            const content = `
                <div class="w-full max-w-md text-center bg-white p-8 rounded-xl shadow-2xl mt-8">
                    <h1 class="text-3xl font-extrabold ${COLOR_ACCENT} mb-4">üéâ K·∫æT QU·∫¢ B√ÄI THI üéâ</h1>
                    <p class="text-lg text-gray-600 mb-6">Th√≠ sinh: <span class="font-bold text-gray-800">${username}</span></p>

                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-5 mb-8 space-y-3">
                        <div class="flex justify-between text-xl">
                            <span class="font-medium text-gray-700">T·ªïng s·ªë c√¢u:</span>
                            <span class="font-bold text-gray-800">${total}</span>
                        </div>
                        <div class="flex justify-between text-xl border-b pb-3">
                            <span class="font-medium text-gray-700">S·ªë c√¢u tr·∫£ l·ªùi ƒë√∫ng:</span>
                            <span class="font-bold ${COLOR_CORRECT}">${correct}/${total}</span>
                        </div>
                        <div class="flex justify-between items-center pt-3">
                            <span class="text-2xl font-extrabold text-gray-800">ƒêi·ªÉm s·ªë (Thang 10):</span>
                            <span class="text-4xl font-black ${scoreColor}">${score.toFixed(2)}/10</span>
                        </div>
                    </div>
                    
                    <div class="p-3 rounded-lg ${statusBg} ${statusColor} text-2xl font-black mb-8 border border-dashed border-current">
                        X·∫æP LO·∫†I: ${status.toUpperCase()}
                        <div class="text-base font-medium text-gray-600 mt-1">
                            (ƒê·∫°t: $\ge ${passThresholdPercent}\%$ c√¢u ƒë√∫ng)
                        </div>
                    </div>

                    <button onclick="showReview()"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-300 shadow-md mb-4">
                        XEM L·∫†I B√ÄI THI CHI TI·∫æT
                    </button>
                    
                    <button onclick="showHome()"
                                class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-800 font-bold py-3 px-6 rounded-lg text-lg transition duration-300">
                        V·ªÅ trang ch·ªß
                    </button>
                </div>
            `;
            document.getElementById('app').innerHTML = content;
        }

        function showReview() {
            clearWindow();
            
            const reviewContent = questions.map((q, i) => {
                const userChoice = userAnswers[i];
                const correctIndex = q.correct_answer_index;
                const alphabet = 'ABCD';
                
                const isCorrect = (userChoice !== -1 && userChoice === correctIndex);
                const statusText = isCorrect ? "‚úÖ ƒê√öNG" : "‚ùå SAI";
                const statusColor = isCorrect ? "text-green-700" : "text-red-700";
                const borderLeftColor = isCorrect ? "border-l-green-600" : "border-l-red-600";


                const optionsHtml = q.options.map((option, j) => {
                    let optionClasses = 'p-3 rounded-lg border text-base flex items-start';
                    let icon = '<span class="mr-2 text-gray-500">‚óã</span>'; 

                    if (j === correctIndex) {
                        // ƒê√°p √°n ƒë√∫ng
                        optionClasses += ' bg-green-100 border-green-400 text-green-700 font-semibold';
                        icon = '<span class="mr-2 text-green-700 font-extrabold">‚úÖ</span>';
                    } else if (j === userChoice && j !== correctIndex) {
                        // ƒê√°p √°n sai ƒë√£ ch·ªçn
                        optionClasses += ' bg-red-100 border-red-400 text-red-700 font-semibold';
                        icon = '<span class="mr-2 text-red-700 font-extrabold">‚ùå</span>';
                    } else {
                        // ƒê√°p √°n c√≤n l·∫°i
                        optionClasses += ' bg-white border-gray-200 text-gray-700';
                    }

                    return `
                        <div class="${optionClasses}">
                            ${icon}
                            <span class="font-bold mr-2">${alphabet[j]}.</span>
                            <span>${option}</span>
                        </div>
                    `;
                }).join('');

                return `
                    <div class="bg-white p-6 rounded-xl shadow-lg mb-6 border-l-4 ${borderLeftColor}">
                        <h3 class="text-xl font-bold mb-3 flex justify-between items-center">
                            <span>C√¢u ${i + 1}: (ID: ${q.id})</span>
                            <span class="${statusColor} text-lg font-extrabold">${statusText}</span>
                        </h3>
                        <p class="text-gray-800 text-lg mb-4 font-semibold leading-relaxed">${q.question}</p>
                        <div class="space-y-3">
                            ${optionsHtml}
                        </div>
                        ${q.source ? `<p class="text-sm italic text-gray-500 mt-4">Ngu·ªìn: ${q.source}</p>` : ''}
                    </div>
                `;
            }).join('');

            // T√≠nh l·∫°i ƒëi·ªÉm
            let correctCount = 0;
            const total = questions.length;
            for (let i = 0; i < total; i++) {
                const userChoice = userAnswers[i];
                const correctIndex = questions[i].correct_answer_index; 
                if (userChoice !== -1 && userChoice === correctIndex) {
                    correctCount++;
                }
            }
            const score = correctCount / total * 10;
            
            // üí° LOGIC X·∫æP LO·∫†I M·ªöI cho m√†n h√¨nh Xem l·∫°i: X·∫øp lo·∫°i chi ti·∫øt
            const status = getRating(correctCount, total);

            const content = `
                <div class="w-full max-w-3xl flex-grow flex flex-col pt-4 pb-20">
                    <h1 class="text-2xl sm:text-3xl font-extrabold ${COLOR_ACCENT} mb-6 text-center">XEM L·∫†I B√ÄI THI CHI TI·∫æT</h1>
                    
                    <div class="flex-grow custom-scroll overflow-y-auto space-y-6">
                        ${reviewContent}
                    </div>

                    <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4 flex justify-center z-10 shadow-lg">
                        <button onclick="showResult(${correctCount}, ${total}, ${score}, '${status}')"
                                class="w-full max-w-md bg-yellow-500 hover:bg-yellow-600 text-gray-800 font-bold py-3 px-6 rounded-lg text-lg transition duration-300 shadow-md">
                            V·ªÅ m√†n h√¨nh k·∫øt qu·∫£
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('app').innerHTML = content;
        }


        // --- KH·ªûI T·∫†O ---
        document.addEventListener('DOMContentLoaded', showHome);

    </script>
</body>
</html>
