<!DOCTYPE html>
<html lang="vi">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>รn luyแปn thi nghiแปp vแปฅ ฤแบฅu thแบงu - Chรบc ae ฤแปฃt 2 thi tแปt!</title>
ย ย 
ย ย <meta name="theme-color" content="#2563EB">ย
ย ย <meta name="apple-mobile-web-app-capable" content="yes">
ย ย <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
ย ย <meta name="apple-mobile-web-app-title" content="Quiz App">

ย ย <script src="https://cdn.tailwindcss.com"></script>
ย ย <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
ย ย <style>
ย ย ย ย /* Tรนy chแปnh font cho toรn bแป แปฉng dแปฅng */
ย ย ย ย body {
ย ย ย ย ย ย font-family: 'Inter', sans-serif;
ย ย ย ย ย ย background-color: #f4f7f9;
ย ย ย ย }
ย ย ย ย /* Custom scrollbar cho cรกc nแปi dung dรi trรชn thiแบฟt bแป di ฤแปng (chแปง yแบฟu cho Options Container) */
ย ย ย ย .custom-scroll::-webkit-scrollbar {
ย ย ย ย ย ย width: 6px;
ย ย ย ย }
ย ย ย ย .custom-scroll::-webkit-scrollbar-thumb {
ย ย ย ย ย ย background: #cbd5e1;
ย ย ย ย ย ย border-radius: 3px;
ย ย ย ย }
ย ย ย ย .custom-scroll {
ย ย ย ย ย ย ย/* แบจn scrollbar trรชn Firefox */
ย ย ย ย ย ย scrollbar-width: thin;ย
ย ย ย ย ย ย scrollbar-color: #cbd5e1 transparent;
ย ย ย ย }
ย ย ย ย /* Hiแปu แปฉng chแปn ฤรกp รกn */
ย ย ย ย .option-item {
ย ย ย ย ย ย transition: all 0.2s;
ย ย ย ย }
ย ย ย ย .option-item:not(.answered):hover {
ย ย ย ย ย ย background-color: #f0f4f7;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย }
ย ย ย ย /* Icon placeholder cho PWA */
ย ย ย ย .app-icon {
ย ย ย ย ย ย display: inline-flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย font-size: 2.5rem;
ย ย ย ย ย ย line-height: 1;
ย ย ย ย ย ย width: 64px;
ย ย ย ย ย ย height: 64px;
ย ย ย ย ย ย border-radius: 16px;
ย ย ย ย ย ย background-color: #2563EB;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
ย ย ย ย }
ย ย </style>
</head>
<body class="min-h-screen flex flex-col">

ย ย <div id="app" class="flex-grow flex flex-col items-center justify-start p-4 sm:p-6">
ย ย ย ย </div>

ย ย <div id="modal-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 items-center justify-center"ย
ย ย ย ย ยrole="dialog" aria-modal="true" aria-labelledby="modal-title">
ย ย ย ย <div class="bg-white rounded-xl p-6 max-w-sm w-full shadow-2xl transition-transform transform scale-100 duration-300">
ย ย ย ย ย ย <h3 id="modal-title" class="text-xl font-bold text-gray-800 mb-4">Thรดng bรกo</h3>
ย ย ย ย ย ย <p id="modal-message" class="text-gray-700 mb-6 whitespace-pre-line"></p>
ย ย ย ย ย ย <div class="flex justify-end space-x-3">
ย ย ย ย ย ย ย ย <button id="modal-cancel-btn" class="hidden px-4 py-2 text-gray-600 bg-gray-200 rounded-lg font-semibold hover:bg-gray-300 transition duration-150" aria-label="Hแปงy bแป">Hแปงy</button>
ย ย ย ย ย ย ย ย <button id="modal-confirm-btn" class="px-4 py-2 text-white bg-blue-600 rounded-lg font-semibold hover:bg-blue-700 transition duration-150" aria-label="ฤแปng รฝ">ฤแปng รฝ</button>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <script>
ย ย ย ย // --- CแบคU HรNH แปจNG DแปคNG (ฤร CแบฌP NHแบฌT THEO YรU CแบฆU) ---
ย ย ย ย const NUM_QUESTIONS = 70;
ย ย ย ย const TIME_LIMIT_MINUTES = 60;

ย ย ย ย // ๐ก CแบคU HรNH XแบพP LOแบI: Ngฦฐแปกng % cรขu ฤรบng ฤแป ฤแบกt mแปi mแปฉc ฤแป
ย ย ย ย // Key lร tรชn xแบฟp loแบกi, Value lร ngฦฐแปกng % TแปI THIแปU cแบงn ฤแบกt
ย ย ย ย const RATING_THRESHOLDS = {
ย ย ย ย ย ย 'Xuแบฅt sแบฏc': 90, // >= 90% (tฦฐฦกng ฤฦฐฦกng 63/70 cรขu)
ย ย ย ย ย ย 'Giแปi': 80,ย ย ย// >= 80% (tฦฐฦกng ฤฦฐฦกng 56/70 cรขu)
ย ย ย ย ย ย 'Khรก': 70,ย ย ย // >= 70% (tฦฐฦกng ฤฦฐฦกng 49/70 cรขu)
ย ย ย ย ย ย 'Trung bรฌnh': 50, // >= 50% (tฦฐฦกng ฤฦฐฦกng 35/70 cรขu - mแปฉc ฤแบกt tแปi thiแปu)
ย ย ย ย };
ย ย ย ย const FAIL_RATING = 'Khรดng ฤแบกt'; // Dฦฐแปi mแปฉc thแบฅp nhแบฅt (dฦฐแปi 50%)
ย ย ย ยย
ย ย ย ย const COLOR_CORRECT = "text-green-700";
ย ย ย ย const COLOR_INCORRECT = "text-red-700";
ย ย ย ย const COLOR_ACCENT = "text-blue-600";
ย ย ย ย // ---------------------------------------------

ย ย ย ย // --- BIแบพN TOรN CแปคC ---
ย ย ย ย let username = "";
ย ย ย ย let questions = [];
ย ย ย ย let currentQuestion = 0;
ย ย ย ย let userAnswers = [];
ย ย ย ย let isAnswered = [];ย
ย ย ย ย let timeLimit = TIME_LIMIT_MINUTES * 60;
ย ย ย ย let timeLeft = timeLimit;
ย ย ย ย let timerInterval;
ย ย ย ย let allQuestions = [];
ย ย ย ยย
ย ย ย ย // Hรm mแปi: Xรกc ฤแปnh xแบฟp loแบกi dแปฑa trรชn sแป cรขu ฤรบng
ย ย ย ย function getRating(correctCount, totalQuestions) {
ย ย ย ย ย ย if (totalQuestions === 0) return FAIL_RATING;

ย ย ย ย ย ย // Tรญnh tแปท lแป % cรขu ฤรบng
ย ย ย ย ย ย const correctPercent = (correctCount / totalQuestions) * 100;
ย ย ย ย ย ยย
ย ย ย ย ย ย // Sแบฏp xแบฟp cรกc ngฦฐแปกng tแปซ cao xuแปng thแบฅp ฤแป kiแปm tra
ย ย ย ย ย ย // ฤiแปu nรy ฤแบฃm bแบฃo 63/70 (90%) sแบฝ ฤฦฐแปฃc xแบฟp lร 'Xuแบฅt sแบฏc' chแปฉ khรดng phแบฃi 'Giแปi'
ย ย ย ย ย ย const sortedRatings = Object.entries(RATING_THRESHOLDS)
ย ย ย ย ย ย ย ย .sort(([, a], [, b]) => b - a);ย
ย ย ย ย ย ยย
ย ย ย ย ย ย for (const [rating, threshold] of sortedRatings) {
ย ย ย ย ย ย ย ย if (correctPercent >= threshold) {
ย ย ย ย ย ย ย ย ย ย return rating;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย return FAIL_RATING;
ย ย ย ย }

ย ย ย ย // Hรm hiแปn thแป Modal (thay thแบฟ messagebox)
ย ย ย ย function showModal(title, message, isConfirm = false, onConfirm = null) {
ย ย ย ย ย ย const backdrop = document.getElementById('modal-backdrop');
ย ย ย ย ย ย const titleEl = document.getElementById('modal-title');
ย ย ย ย ย ย const messageEl = document.getElementById('modal-message');
ย ย ย ย ย ย const confirmBtn = document.getElementById('modal-confirm-btn');
ย ย ย ย ย ย const cancelBtn = document.getElementById('modal-cancel-btn');

ย ย ย ย ย ย titleEl.textContent = title;
ย ย ย ย ย ย messageEl.textContent = message;

ย ย ย ย ย ย // ฤแบฃm bแบฃo Modal ฤฦฐแปฃc focus ฤรบng
ย ย ย ย ย ย backdrop.focus();

ย ย ย ย ย ย backdrop.classList.remove('hidden');
ย ย ย ย ย ย backdrop.classList.add('flex');

ย ย ย ย ย ย confirmBtn.onclick = () => {
ย ย ย ย ย ย ย ย backdrop.classList.add('hidden');
ย ย ย ย ย ย ย ย backdrop.classList.remove('flex');
ย ย ย ย ย ย ย ย if (isConfirm && onConfirm) {
ย ย ย ย ย ย ย ย ย ย // Cแบงn xรณa timer sau khi nแปp bรi
ย ย ย ย ย ย ย ย ย ย if (timerInterval) clearInterval(timerInterval);
ย ย ย ย ย ย ย ย ย ย onConfirm();
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย };

ย ย ย ย ย ย if (isConfirm) {
ย ย ย ย ย ย ย ย cancelBtn.classList.remove('hidden');
ย ย ย ย ย ย ย ย cancelBtn.onclick = () => {
ย ย ย ย ย ย ย ย ย ย backdrop.classList.add('hidden');
ย ย ย ย ย ย ย ย ย ย backdrop.classList.remove('flex');
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย confirmBtn.textContent = "Nแปp bรi";
ย ย ย ย ย ย ย ย confirmBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
ย ย ย ย ย ย ย ย confirmBtn.classList.add('bg-red-600', 'hover:bg-red-700');
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย cancelBtn.classList.add('hidden');
ย ย ย ย ย ย ย ย confirmBtn.textContent = "ฤรณng";
ย ย ย ย ย ย ย ย confirmBtn.classList.remove('bg-red-600', 'hover:bg-red-700');
ย ย ย ย ย ย ย ย confirmBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // ฤแปc dแปฏ liแปu tแปซ file JSON (mรด phแปng load_questions)
ย ย ย ย async function loadQuestions() {
ย ย ย ย ย ย if (allQuestions.length > 0) return allQuestions;
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Sแปฌ DแปคNG FILE Tแปช KHO LฦฏU TRแปฎ CแปฆA NGฦฏแปI DรNG
ย ย ย ย ย ย ย ย const response = await fetch('de_full.json');ย
ย ย ย ย ย ย ย ย if (!response.ok) {
ย ย ย ย ย ย ย ย ย ย throw new Error(`Tแบฃi lแปi. Status: ${response.status}`);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย allQuestions = await response.json();
ย ย ย ย ย ย ย ย return allQuestions;
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย showModal("Lแปi hแป thแปng", `Lแปi khi tแบฃi cรขu hแปi: Vui lรฒng kiแปm tra file de_full.json cแปงa bแบกn:\n${error.message}`);
ย ย ย ย ย ย ย ย return [];
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // Ghi kแบฟt quแบฃ (trong Web App, chรบng ta chแป hiแปn thแป, khรดng lฦฐu vรo CSV)
ย ย ย ย function saveResult(name, correct, total, score, status) {
ย ย ย ย ย ย console.log(`Kแบฟt quแบฃ cแปงa ${name}: ฤรบng ${correct}/${total}, ฤiแปm: ${score.toFixed(2)}, Xแบฟp loแบกi: ${status}`);
ย ย ย ย }

ย ย ย ย // --- QUแบขN Lร GIAO DIแปN ---

ย ย ย ย function clearWindow() {
ย ย ย ย ย ย document.getElementById('app').innerHTML = '';
ย ย ย ย }

ย ย ย ย function updateTimerDisplay() {
ย ย ย ย ย ย const minutes = Math.floor(timeLeft / 60);
ย ย ย ย ย ย const seconds = timeLeft % 60;
ย ย ย ย ย ย const timeText = `โฐ ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
ย ย ย ย ย ย const timerEl = document.getElementById('timer-label');
ย ย ย ย ย ย if (timerEl) {
ย ย ย ย ย ย ย ย timerEl.textContent = timeText;
ย ย ย ย ย ย ย ย if (timeLeft <= 60) {
ย ย ย ย ย ย ย ย ย ย timerEl.classList.remove('text-red-600');
ย ย ย ย ย ย ย ย ย ย timerEl.classList.add('text-red-800', 'font-extrabold', 'animate-pulse');
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย timerEl.classList.remove('text-red-800', 'font-extrabold', 'animate-pulse');
ย ย ย ย ย ย ย ย ย ย timerEl.classList.add('text-red-600');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function startTimer() {
ย ย ย ย ย ย if (timerInterval) clearInterval(timerInterval);
ย ย ย ย ย ย timerInterval = setInterval(() => {
ย ย ย ย ย ย ย ย if (timeLeft > 0) {
ย ย ย ย ย ย ย ย ย ย timeLeft--;
ย ย ย ย ย ย ย ย ย ย updateTimerDisplay();
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย clearInterval(timerInterval);
ย ย ย ย ย ย ย ย ย ย showModal("Hแบฟt giแป", "Bแบกn ฤรฃ hแบฟt thแปi gian lรm bรi. Bรi lรm sแบฝ ฤฦฐแปฃc tแปฑ ฤแปng nแปp.", false); // Khรดng cแบงn callback, vรฌ submitQuiz() sแบฝ ฤฦฐแปฃc gแปi ngay
ย ย ย ย ย ย ย ย ย ย submitQuiz();
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }, 1000);
ย ย ย ย }

ย ย ย ย // --- Xแปฌ Lร LฦฏU ฤรP รN Vร PHแบขN HแปI ---
ย ย ย ย function handleAnswerSelection(selectedOptionIndex) {
ย ย ย ย ย ย const qIndex = currentQuestion;
ย ย ย ย ย ยย
ย ย ย ย ย ย // Trong chแบฟ ฤแป Luyแปn tแบญp (chแบฟ ฤแป mแบทc ฤแปnh), phแบฃn hแปi ngay.
ย ย ย ย ย ย if (isAnswered[qIndex]) {
ย ย ย ย ย ย ย ย return;ย
ย ย ย ย ย ย }

ย ย ย ย ย ย userAnswers[qIndex] = selectedOptionIndex;
ย ย ย ย ย ย isAnswered[qIndex] = true;
ย ย ย ย ย ยย
ย ย ย ย ย ย showQuestion(); // Vแบผ LแบI ฤแป รกp dแปฅng mรu sแบฏc phแบฃn hแปi
ย ย ย ย }

ย ย ย ย // --- CรC MรN HรNH CHรNH ---

ย ย ย ย function showHome() {
ย ย ย ย ย ย clearWindow();
ย ย ย ย ย ย if (timerInterval) clearInterval(timerInterval);

ย ย ย ย ย ย const content = `
ย ย ย ย ย ย ย ย <div class="max-w-xl w-full text-center bg-white p-6 sm:p-8 rounded-xl shadow-2xl mt-8 flex flex-col items-center">
ย ย ย ย ย ย ย ย ย ย <span class="app-icon mb-6">๐</span>
ย ย ย ย ย ย ย ย ย ย <h1 class="text-3xl sm:text-4xl font-extrabold ${COLOR_ACCENT} mb-2">รN LUYแปN THI NGHIแปP Vแปค ฤแบคU THแบฆU</h1>
ย ย ย ย ย ย ย ย ย ย <h2 class="text-xl sm:text-2xl font-semibold text-gray-700 mb-8 italic">Chรบc ae ฤแปฃt 2 thi tแปt! (Chแบฟ ฤแป Luyแปn tแบญp)</h2>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <label for="name-entry" class="block text-left w-full text-gray-700 font-semibold mb-2 text-lg">Nhแบญp tรชn cแปงa bแบกn:</label>
ย ย ย ย ย ย ย ย ย ย <input type="text" id="name-entry" placeholder="Vรญ dแปฅ: Nguyแปn Vฤn A"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยclass="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg mb-8" />
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <button id="start-quiz-btn"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="w-full bg-green-600 hover:bg-green-700 text-white font-extrabold py-4 px-6 rounded-xl text-xl transition duration-300 shadow-lg transform hover:scale-[1.01]">
ย ย ย ย ย ย ย ย ย ย ย ย Bแบฏt ฤแบงu lรm bรi (${NUM_QUESTIONS} cรขu, ${TIME_LIMIT_MINUTES} phรบt)
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <p class="text-sm text-gray-500 mt-4">Dแปฏ liแปu ฤฦฐแปฃc lแบฅy tแปซ file de_full.json</p>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย ย ย document.getElementById('app').innerHTML = content;
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('start-quiz-btn').addEventListener('click', startQuiz);
ย ย ย ย }

ย ย ย ย async function startQuiz() {
ย ย ย ย ย ย const nameEntry = document.getElementById('name-entry');
ย ย ย ย ย ย const name = nameEntry.value.trim();

ย ย ย ย ย ย if (!name) {
ย ย ย ย ย ย ย ย showModal("Thiแบฟu tรชn", "Vui lรฒng nhแบญp tรชn cแปงa bแบกn.");
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย username = name;
ย ย ย ย ย ยย
ย ย ย ย ย ย allQuestions = await loadQuestions();

ย ย ย ย ย ย if (allQuestions.length === 0) return;
ย ย ย ย ย ย ยย
ย ย ย ย ย ย if (allQuestions.length < NUM_QUESTIONS) {
ย ย ย ย ย ย ย ย showModal("Lแปi", `Ngรขn hรng cรขu hแปi phแบฃi cรณ รญt nhแบฅt ${NUM_QUESTIONS} cรขu. Hiแปn cรณ ${allQuestions.length} cรขu. Vui lรฒng kiแปm tra lแบกi file JSON.`);
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }

ย ย ย ย ย ย // Lแบฅy ngแบซu nhiรชn cรขu hแปi (Fisher-Yates shuffle)
ย ย ย ย ย ย const shuffledQuestions = [...allQuestions];
ย ย ย ย ย ย for (let i = shuffledQuestions.length - 1; i > 0; i--) {
ย ย ย ย ย ย ย ย const j = Math.floor(Math.random() * (i + 1));
ย ย ย ย ย ย ย ย [shuffledQuestions[i], shuffledQuestions[j]] = [shuffledQuestions[j], shuffledQuestions[i]];
ย ย ย ย ย ย }

ย ย ย ย ย ย questions = shuffledQuestions.slice(0, NUM_QUESTIONS);

ย ย ย ย ย ย // Khแปi tแบกo trแบกng thรกi
ย ย ย ย ย ย userAnswers = Array(questions.length).fill(-1);ย
ย ย ย ย ย ย isAnswered = Array(questions.length).fill(false);ย
ย ย ย ย ย ย currentQuestion = 0;
ย ย ย ย ย ย timeLeft = timeLimit;

ย ย ย ย ย ย startTimer();
ย ย ย ย ย ย showQuestion();
ย ย ย ย }


ย ย ย ย function showQuestion() {
ย ย ย ย ย ย clearWindow();
ย ย ย ย ย ย const question = questions[currentQuestion];
ย ย ย ย ย ย const selectedAnswer = userAnswers[currentQuestion];
ย ย ย ย ย ย const correctIndex = question.correct_answer_index;
ย ย ย ย ย ย const isCurrentQAnswered = isAnswered[currentQuestion];
ย ย ย ย ย ย const alphabet = 'ABCD';

ย ย ย ย ย ย const header = `
ย ย ย ย ย ย ย ย <div class="fixed top-0 left-0 w-full bg-white shadow-md p-3 sm:p-4 flex justify-between items-center z-10">
ย ย ย ย ย ย ย ย ย ย <div class="text-xs sm:text-base font-medium text-gray-600">Thรญ sinh: <span class="font-bold text-gray-800">${username}</span></div>
ย ย ย ย ย ย ย ย ย ย <div id="timer-label" class="text-sm sm:text-lg font-bold text-red-600 transition-colors duration-500"></div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="h-12 sm:h-16 w-full"></div> `;

ย ย ย ย ย ย const questionContent = `
ย ย ย ย ย ย ย ย <div class="w-full max-w-2xl bg-white p-5 sm:p-6 rounded-xl shadow-lg flex-grow flex flex-col mb-4">
ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between items-center mb-4">
ย ย ย ย ย ย ย ย ย ย ย ย <h2 class="text-xl sm:text-2xl font-extrabold ${COLOR_ACCENT}">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย Cรขu ${currentQuestion + 1}/${questions.length}
ย ย ย ย ย ย ย ย ย ย ย ย </h2>
ย ย ย ย ย ย ย ย ย ย ย ย <span class="text-sm font-medium text-gray-500">ID: ${question.id}</span>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <p class="text-gray-800 text-lg sm:text-xl font-semibold mb-6 leading-relaxed">
ย ย ย ย ย ย ย ย ย ย ย ย ${question.question}
ย ย ย ย ย ย ย ย ย ย </p>

ย ย ย ย ย ย ย ย ย ย <div id="options-container" class="space-y-4 flex-grow custom-scroll overflow-y-auto pb-4">
ย ย ย ย ย ย ย ย ย ย ย ย ${question.options.map((option, i) => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย let optionClasses = 'option-item p-4 rounded-lg border shadow-sm transition duration-150';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย let icon = '<span class="text-gray-400 font-bold mr-3 text-lg">โ</span>'; // Mแบทc ฤแปnh chฦฐa chแปn

ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (isCurrentQAnswered) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย // Nแบฟu ฤรฃ trแบฃ lแปi vร ฤรNG
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (i === correctIndex) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย optionClasses += ` bg-green-100 border-green-400 ${COLOR_CORRECT} answered font-bold`;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย icon = '<span class="text-green-600 font-extrabold mr-3 text-lg">โ</span>';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย // Nแบฟu ฤรฃ trแบฃ lแปi vร SAI (vร ฤรณ lร ฤรกp รกn ngฦฐแปi dรนng chแปn)
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย else if (i === selectedAnswer && i !== correctIndex) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย optionClasses += ` bg-red-100 border-red-400 ${COLOR_INCORRECT} answered font-bold`;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย icon = '<span class="text-red-600 font-extrabold mr-3 text-lg">โ</span>';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย // Cรกc ฤรกp รกn cรฒn lแบกi (ฤรฃ trแบฃ lแปi)
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย optionClasses += ` bg-gray-50 text-gray-600 answered`;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย // Chฦฐa trแบฃ lแปi (Chแป tรด mรu lแปฑa chแปn hiแปn tแบกi)
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย optionClasses += ' hover:bg-blue-50';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (i === selectedAnswer) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย optionClasses += ' bg-blue-100 border-blue-400 font-bold';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย icon = '<span class="text-blue-600 font-extrabold mr-3 text-lg">โ</span>';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย icon = '<span class="text-gray-500 font-bold mr-3 text-lg">โ</span>';ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div id="option-${i}" data-index="${i}"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="${optionClasses} flex items-start text-base sm:text-lg"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย onclick="handleAnswerSelection(${i})">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${icon}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-bold mr-2 text-gray-700">${alphabet[i]}.</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="flex-grow text-gray-800">${option}</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย ย ย ย ย }).join('')}
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;

ย ย ย ย ย ย const footer = `
ย ย ย ย ย ย ย ย <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-3 sm:p-4 flex justify-center items-center space-x-3 sm:space-x-4 z-10 shadow-lg">
ย ย ย ย ย ย ย ย ย ย <button id="prev-btn"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="flex-1 max-w-[150px] bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition duration-150 text-sm sm:text-lg">
ย ย ย ย ย ย ย ย ย ย ย ย โ Quay lแบกi
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ${currentQuestion < questions.length - 1 ?ย
ย ย ย ย ย ย ย ย ย ย ย ย `<button id="next-btn"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยclass="flex-1 max-w-[150px] bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 text-sm sm:text-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย Tiแบฟp theo โ
ย ย ย ย ย ย ย ย ย ย ย ย </button>`
ย ย ย ย ย ย ย ย ย ย ย ย :
ย ย ย ย ย ย ย ย ย ย ย ย `<button id="submit-btn"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยclass="flex-1 max-w-[150px] bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 text-sm sm:text-lg">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย Nแปp bรi
ย ย ย ย ย ย ย ย ย ย ย ย </button>`
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('app').innerHTML = header + questionContent + footer;

ย ย ย ย ย ย // Cแบญp nhแบญt lแบกi Timer
ย ย ย ย ย ย updateTimerDisplay();

ย ย ย ย ย ย // Cรi ฤแบทt sแปฑ kiแปn
ย ย ย ย ย ย const prevBtn = document.getElementById('prev-btn');
ย ย ย ย ย ย if (currentQuestion === 0) {
ย ย ย ย ย ย ย ย prevBtn.disabled = true;
ย ย ย ย ย ย ย ย prevBtn.classList.add('opacity-50', 'cursor-not-allowed');
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย prevBtn.addEventListener('click', prevQuestion);
ย ย ย ย ย ย }

ย ย ย ย ย ย if (currentQuestion < questions.length - 1) {
ย ย ย ย ย ย ย ย document.getElementById('next-btn').addEventListener('click', nextQuestion);
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย document.getElementById('submit-btn').addEventListener('click', confirmSubmit);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function nextQuestion() {
ย ย ย ย ย ย currentQuestion = Math.min(currentQuestion + 1, questions.length - 1);
ย ย ย ย ย ย showQuestion();
ย ย ย ย }

ย ย ย ย function prevQuestion() {
ย ย ย ย ย ย currentQuestion = Math.max(currentQuestion - 1, 0);
ย ย ย ย ย ย showQuestion();
ย ย ย ย }

ย ย ย ย function confirmSubmit() {
ย ย ย ย ย ย const unansweredCount = userAnswers.filter(a => a === -1).length;
ย ย ย ย ย ยย
ย ย ย ย ย ย let confirmMessage = `Bแบกn cรณ chแบฏc chแบฏn muแปn nแปp bรi khรดng?`;
ย ย ย ย ย ย if (unansweredCount > 0) {
ย ย ย ย ย ย ย ย ยconfirmMessage += `\n(Bแบกn cรฒn ${unansweredCount} cรขu chฦฐa chแปn ฤรกp รกn.)`;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย showModal("Xรกc nhแบญn nแปp bรi", confirmMessage, true, submitQuiz);
ย ย ย ย }

ย ย ย ย function submitQuiz() {
ย ย ย ย ย ย if (timerInterval) clearInterval(timerInterval);
ย ย ย ย ย ยย
ย ย ย ย ย ย let correct = 0;
ย ย ย ย ย ย const total = questions.length;

ย ย ย ย ย ย for (let i = 0; i < total; i++) {
ย ย ย ย ย ย ย ย const userChoice = userAnswers[i];
ย ย ย ย ย ย ย ย const correctIndex = questions[i].correct_answer_index;ย

ย ย ย ย ย ย ย ย if (userChoice !== -1 && userChoice === correctIndex) {
ย ย ย ย ย ย ย ย ย ย correct++;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย // Vแบซn tรญnh ฤiแปm ฤแป hiแปn thแป trรชn thang 10
ย ย ย ย ย ย const score = correct / total * 10;ย
ย ย ย ย ย ยย
ย ย ย ย ย ย // ๐ก LOGIC XแบพP LOแบI MแปI: Xแบฟp loแบกi chi tiแบฟt theo % cรขu ฤรบng
ย ย ย ย ย ย const status = getRating(correct, total);ย

ย ย ย ย ย ย saveResult(username, correct, total, score, status);ย
ย ย ย ย ย ย showResult(correct, total, score, status);
ย ย ย ย }

ย ย ย ย function showResult(correct, total, score, status) {
ย ย ย ย ย ย clearWindow();
ย ย ย ย ย ยย
ย ย ย ย ย ย // Kiแปm tra xem trแบกng thรกi cรณ phแบฃi lร "Khรดng ฤแบกt" hay khรดng
ย ย ย ย ย ย const isPassing = status !== FAIL_RATING;ย
ย ย ย ย ย ยย
ย ย ย ย ย ย const statusColor = isPassing ? COLOR_CORRECT : COLOR_INCORRECT;
ย ย ย ย ย ย const statusBg = isPassing ? "bg-green-50" : "bg-red-50";

ย ย ย ย ย ย // Thay ฤแปi mรu ฤiแปm dแปฑa trรชn kแบฟt quแบฃ
ย ย ย ย ย ย const scoreColor = isPassing ? COLOR_CORRECT : COLOR_INCORRECT;
ย ย ย ย ย ยย
ย ย ย ย ย ย // Lแบฅy ngฦฐแปกng % cแปงa mแปฉc Trung bรฌnh (mแปฉc ฤแบกt tแปi thiแปu) ฤแป hiแปn thแป thรดng tin
ย ย ย ย ย ย const passThresholdPercent = RATING_THRESHOLDS['Trung bรฌnh'];

ย ย ย ย ย ย const content = `
ย ย ย ย ย ย ย ย <div class="w-full max-w-md text-center bg-white p-8 rounded-xl shadow-2xl mt-8">
ย ย ย ย ย ย ย ย ย ย <h1 class="text-3xl font-extrabold ${COLOR_ACCENT} mb-4">๐ KแบพT QUแบข BรI THI ๐</h1>
ย ย ย ย ย ย ย ย ย ย <p class="text-lg text-gray-600 mb-6">Thรญ sinh: <span class="font-bold text-gray-800">${username}</span></p>

ย ย ย ย ย ย ย ย ย ย <div class="border-2 border-dashed border-gray-300 rounded-xl p-5 mb-8 space-y-3">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between text-xl">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-medium text-gray-700">Tแปng sแป cรขu:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-bold text-gray-800">${total}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between text-xl border-b pb-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-medium text-gray-700">Sแป cรขu trแบฃ lแปi ฤรบng:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-bold ${COLOR_CORRECT}">${correct}/${total}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="flex justify-between items-center pt-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text-2xl font-extrabold text-gray-800">ฤiแปm sแป (Thang 10):</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="text-4xl font-black ${scoreColor}">${score.toFixed(2)}/10</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="p-3 rounded-lg ${statusBg} ${statusColor} text-2xl font-black mb-8 border border-dashed border-current">
ย ย ย ย ย ย ย ย ย ย ย ย XแบพP LOแบI: ${status.toUpperCase()}
ย ย ย ย ย ย ย ย ย ย ย ย <div class="text-base font-medium text-gray-600 mt-1">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย (ฤแบกt: $\ge ${passThresholdPercent}\%$ cรขu ฤรบng)
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <button onclick="showReview()"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition duration-300 shadow-md mb-4">
ย ย ย ย ย ย ย ย ย ย ย ย XEM LแบI BรI THI CHI TIแบพT
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <button onclick="showHome()"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="w-full bg-yellow-500 hover:bg-yellow-600 text-gray-800 font-bold py-3 px-6 rounded-lg text-lg transition duration-300">
ย ย ย ย ย ย ย ย ย ย ย ย Vแป trang chแปง
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย ย ย document.getElementById('app').innerHTML = content;
ย ย ย ย }

ย ย ย ย function showReview() {
ย ย ย ย ย ย clearWindow();
ย ย ย ย ย ยย
ย ย ย ย ย ย const reviewContent = questions.map((q, i) => {
ย ย ย ย ย ย ย ย const userChoice = userAnswers[i];
ย ย ย ย ย ย ย ย const correctIndex = q.correct_answer_index;
ย ย ย ย ย ย ย ย const alphabet = 'ABCD';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const isCorrect = (userChoice !== -1 && userChoice === correctIndex);
ย ย ย ย ย ย ย ย const statusText = isCorrect ? "โ ฤรNG" : "โ SAI";
ย ย ย ย ย ย ย ย const statusColor = isCorrect ? "text-green-700" : "text-red-700";
ย ย ย ย ย ย ย ย const borderLeftColor = isCorrect ? "border-l-green-600" : "border-l-red-600";


ย ย ย ย ย ย ย ย const optionsHtml = q.options.map((option, j) => {
ย ย ย ย ย ย ย ย ย ย let optionClasses = 'p-3 rounded-lg border text-base flex items-start';
ย ย ย ย ย ย ย ย ย ย let icon = '<span class="mr-2 text-gray-500">โ</span>';ย

ย ย ย ย ย ย ย ย ย ย if (j === correctIndex) {
ย ย ย ย ย ย ย ย ย ย ย ย // ฤรกp รกn ฤรบng
ย ย ย ย ย ย ย ย ย ย ย ย optionClasses += ' bg-green-100 border-green-400 text-green-700 font-semibold';
ย ย ย ย ย ย ย ย ย ย ย ย icon = '<span class="mr-2 text-green-700 font-extrabold">โ</span>';
ย ย ย ย ย ย ย ย ย ย } else if (j === userChoice && j !== correctIndex) {
ย ย ย ย ย ย ย ย ย ย ย ย // ฤรกp รกn sai ฤรฃ chแปn
ย ย ย ย ย ย ย ย ย ย ย ย optionClasses += ' bg-red-100 border-red-400 text-red-700 font-semibold';
ย ย ย ย ย ย ย ย ย ย ย ย icon = '<span class="mr-2 text-red-700 font-extrabold">โ</span>';
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย // ฤรกp รกn cรฒn lแบกi
ย ย ย ย ย ย ย ย ย ย ย ย optionClasses += ' bg-white border-gray-200 text-gray-700';
ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย ย ย ย ย <div class="${optionClasses}">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${icon}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="font-bold mr-2">${alphabet[j]}.</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span>${option}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย }).join('');

ย ย ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย ย ย <div class="bg-white p-6 rounded-xl shadow-lg mb-6 border-l-4 ${borderLeftColor}">
ย ย ย ย ย ย ย ย ย ย ย ย <h3 class="text-xl font-bold mb-3 flex justify-between items-center">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span>Cรขu ${i + 1}: (ID: ${q.id})</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="${statusColor} text-lg font-extrabold">${statusText}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </h3>
ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-gray-800 text-lg mb-4 font-semibold leading-relaxed">${q.question}</p>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="space-y-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${optionsHtml}
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ${q.source ? `<p class="text-sm italic text-gray-500 mt-4">Nguแปn: ${q.source}</p>` : ''}
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย }).join('');

ย ย ย ย ย ย // Tรญnh lแบกi ฤiแปm
ย ย ย ย ย ย let correctCount = 0;
ย ย ย ย ย ย const total = questions.length;
ย ย ย ย ย ย for (let i = 0; i < total; i++) {
ย ย ย ย ย ย ย ย const userChoice = userAnswers[i];
ย ย ย ย ย ย ย ย const correctIndex = questions[i].correct_answer_index;ย
ย ย ย ย ย ย ย ย if (userChoice !== -1 && userChoice === correctIndex) {
ย ย ย ย ย ย ย ย ย ย correctCount++;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ย const score = correctCount / total * 10;
ย ย ย ย ย ยย
ย ย ย ย ย ย // ๐ก LOGIC XแบพP LOแบI MแปI cho mรn hรฌnh Xem lแบกi: Xแบฟp loแบกi chi tiแบฟt
ย ย ย ย ย ย const status = getRating(correctCount, total);

ย ย ย ย ย ย const content = `
ย ย ย ย ย ย ย ย <div class="w-full max-w-3xl flex-grow flex flex-col pt-4 pb-20">
ย ย ย ย ย ย ย ย ย ย <h1 class="text-2xl sm:text-3xl font-extrabold ${COLOR_ACCENT} mb-6 text-center">XEM LแบI BรI THI CHI TIแบพT</h1>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="flex-grow custom-scroll overflow-y-auto space-y-6">
ย ย ย ย ย ย ย ย ย ย ย ย ${reviewContent}
ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <div class="fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 p-4 flex justify-center z-10 shadow-lg">
ย ย ย ย ย ย ย ย ย ย ย ย <button onclick="showResult(${correctCount}, ${total}, ${score}, '${status}')"
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย class="w-full max-w-md bg-yellow-500 hover:bg-yellow-600 text-gray-800 font-bold py-3 px-6 rounded-lg text-lg transition duration-300 shadow-md">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย Vแป mรn hรฌnh kแบฟt quแบฃ
ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย ย ย document.getElementById('app').innerHTML = content;
ย ย ย ย }


ย ย ย ย // --- KHแปI TแบO ---
ย ย ย ย document.addEventListener('DOMContentLoaded', showHome);

ย ย </script>
</body>
</html>
